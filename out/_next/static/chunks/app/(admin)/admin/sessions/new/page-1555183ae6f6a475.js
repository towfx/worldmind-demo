(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4584],{6339:(e,s,a)=>{Promise.resolve().then(a.bind(a,84985))},37800:(e,s,a)=>{"use strict";a.d(s,{Dz:()=>l,NJ:()=>i,SA:()=>c,YG:()=>n});var t=a(15616);let r="courses",i=async()=>{console.log("[api][getCourses] Fetching all courses");try{let e=await (0,t.P)(r);if(!Array.isArray(e))return console.error("[api][getCourses] Expected array but got:",typeof e,e),[];let s=e.map(e=>{if(e.features&&"string"==typeof e.features)try{e.features=JSON.parse(e.features)}catch(s){console.error("[api][getCourses] Error parsing features for course ".concat(e.id,":"),s),e.features=[]}return e.price&&"string"==typeof e.price&&(e.price=Number.parseFloat(e.price)),e});return console.log("[api][getCourses] Fetched and processed courses:",s.length),s}catch(e){return console.error("[api][getCourses] Error fetching courses:",e),[]}},n=async e=>{console.log("[api][getCourseById] Fetching course with id:",e);try{let s=await (0,t.P)("".concat(r,"/").concat(e));if(console.log("[api][getCourseById] Raw course data:",s),s.features&&"string"==typeof s.features)try{let e=JSON.parse(s.features);console.log("[api][getCourseById] Parsed features:",e),Array.isArray(e)?s.features=e:(console.warn("[api][getCourseById] Features is not an array after parsing:",e),s.features=[])}catch(a){console.error("[api][getCourseById] Error parsing features for course ".concat(e,":"),a),s.features=[]}else Array.isArray(s.features)||(console.warn("[api][getCourseById] Features is not a string or array:",typeof s.features,s.features),s.features=[]);if(s.audiences&&"string"==typeof s.audiences)try{let e=JSON.parse(s.audiences);console.log("[api][getCourseById] Parsed audiences:",e),Array.isArray(e)?s.audiences=e:(console.warn("[api][getCourseById] Features is not an array after parsing:",e),s.audiences=[])}catch(a){console.error("[api][getCourseById] Error parsing features for course ".concat(e,":"),a),s.audiences=[]}else Array.isArray(s.audiences)||(console.warn("[api][getCourseById] Audiences is not a string or array:",typeof s.audiences,s.audiences),s.audiences=[]);return s.price&&"string"==typeof s.price&&(s.price=Number.parseFloat(s.price)),console.log("[api][getCourseById] Processed course:",{id:s.id,title:s.title,features:Array.isArray(s.features)?"Array(".concat(s.features.length,")"):typeof s.features}),s}catch(s){throw console.error("[api][getCourseById] Error fetching course with ID ".concat(e,":"),s),s}},c=async e=>{console.log("[api][createCourseData] Creating complete course data:",e);try{let s=await (0,t.Em)("courses/createCourseData","POST",e);return console.log("[api][createCourseData] Created complete course data:",{id:s.id,title:s.title}),s}catch(e){throw console.error("[api][createCourseData] Error creating complete course data:",e),e}},l=async e=>{console.log("[api][updateCourseData] Updating complete course data:",e);try{let s=await (0,t.Em)("courses/updateCourseData","PUT",e);return console.log("[api][updateCourseData] Updated complete course data:",{id:s.id,title:s.title}),s}catch(e){throw console.error("[api][updateCourseData] Error updating complete course data:",e),e}}},84985:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>S});var t=a(2432),r=a(80364),i=a(39262),n=a(77382),c=a(2708),l=a(87304),o=a(22438),d=a(45092),u=a(21283),m=a(63844),g=a(83881),p=a(92105),h=a(66602),x=a(9956),j=a(37800),v=a(82890),f=a(56861),y=a(54889),N=a(15616);let C=e=>{let{value:s,onChange:a,label:r,error:i}=e;return(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o.J,{htmlFor:r,className:i?"text-destructive":"",children:r}),(0,t.jsx)(l.p,{id:r,type:"time",value:s,onChange:e=>a(e.target.value),className:i?"border-destructive":""}),i&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:i})]})},I=e=>{let{value:s,onChange:a,label:r,error:i}=e;return(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o.J,{htmlFor:r,className:i?"text-destructive":"",children:r}),(0,t.jsx)(l.p,{id:r,type:"date",value:s,onChange:e=>a(e.target.value),className:i?"border-destructive":""}),i&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:i})]})},b=()=>new Date().toISOString().split("T")[0],k=()=>{let e=new Date,s=e.getHours(),a=30*(e.getMinutes()>=30);return"".concat(s.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0"))};function S(){let{t:e}=(0,p.Bd)(),s=(0,i.useRouter)(),{toast:a}=(0,u.dj)(),[S,w]=(0,r.useState)([]),[F,E]=(0,r.useState)([]),[T,q]=(0,r.useState)([]),[R,B]=(0,r.useState)([]),[D,O]=(0,r.useState)(!0),[P,J]=(0,r.useState)(null),{register:A,handleSubmit:_,control:L,watch:H,setValue:V,formState:{errors:z,isSubmitting:Z}}=(0,h.mN)({defaultValues:{title:"",instructorId:"",courseId:"",packageId:"",classId:"",date:b(),startTime:k(),duration:"90",isOnline:!0,location:"https://zoom.us/j/123456789",capacity:"20"}}),$=H("courseId"),U=H("packageId"),M=H("classId"),W=H("isOnline");(0,r.useEffect)(()=>{(async()=>{O(!0),J(null);try{console.log("[FETCH] Loading courses and instructors");let[e,s]=await Promise.all([(0,j.NJ)(),(0,v.DN)()]);console.log("[FETCH] Courses loaded:",e.length),console.log("[FETCH] Instructors loaded:",s.length),w(e),q(s),s.length>0&&V("instructorId",s[0].id.toString())}catch(e){console.error("[ERROR] Failed to load initial data:",e),J("Failed to load courses and instructors. Please try again.")}finally{O(!1)}})()},[V]),(0,r.useEffect)(()=>{(async()=>{if($){console.log("[FETCH] Loading packages for course:",$);try{let e=await (0,f.FJ)(Number.parseInt($));console.log("[FETCH] Packages loaded:",e.length),E(e),V("packageId",""),V("classId",""),B([])}catch(e){console.error("[ERROR] Failed to load course packages:",e),E([])}}else E([]),V("packageId",""),V("classId",""),B([])})()},[$,V]),(0,r.useEffect)(()=>{(async()=>{if(U)try{console.log("[FETCH] Loading course package classes for package:",U);let e=await (0,y.Ht)(Number.parseInt(U));console.log("[FETCH] Course package classes loaded:",e.length),B(e),V("classId","")}catch(e){console.error("[ERROR] Failed to load course package classes:",e),B([])}else B([]),V("classId","")})()},[U,V]),(0,r.useEffect)(()=>{if(M){let s=R.find(e=>e.id===Number.parseInt(M));if(s){if(console.log("[PREFILL] Selected class:",s),H("title")||V("title",s.title||""),"90"===H("duration")){var e;V("duration",(null===(e=s.duration)||void 0===e?void 0:e.toString())||"90")}if(s.class_type){let e="online"===s.class_type;V("isOnline",e),e&&"Room 101"===H("location")?V("location","https://zoom.us/j/123456789"):e||"https://zoom.us/j/123456789"!==H("location")||V("location","Room 101")}}}},[M,R,V,H]),(0,r.useEffect)(()=>{W&&"Room 101"===H("location")?V("location","https://zoom.us/j/123456789"):W||"https://zoom.us/j/123456789"!==H("location")||V("location","Room 101")},[W,V,H]);let G=async e=>{try{console.log("[SUBMIT] Creating new session with data:",e);let t=new Date("".concat(e.date,"T").concat(e.startTime,":00")),r={course_package_classes_id:Number.parseInt(e.classId),instructor_id:Number.parseInt(e.instructorId),scheduled_at:(0,N.Ow)(t),duration:Number.parseInt(e.duration),status:"upcoming",online_meeting_link:e.isOnline?e.location:null,offline_location:e.isOnline?null:e.location,title:e.title};await (0,x.$L)(r),a({title:"Session created",description:"The session has been successfully created.",variant:"success"}),s.push("/admin/calendar")}catch(e){console.error("[ERROR] Failed to create session:",e),a({title:"Creation failed",description:"Failed to create the session. Please try again.",variant:"destructive"})}};return D?(0,t.jsx)("div",{className:"p-6 flex justify-center items-center min-h-[60vh]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-muted-foreground",children:e("admin.sessions.loading","Loading...")})]})}):P?(0,t.jsx)("div",{className:"p-6 flex justify-center items-center min-h-[60vh]",children:(0,t.jsxs)(n.Zp,{className:"w-full max-w-md",children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{className:"text-destructive",children:e("admin.sessions.error","Error")}),(0,t.jsx)(n.BT,{children:P})]}),(0,t.jsx)(n.wL,{children:(0,t.jsx)(c.$,{onClick:()=>s.push("/admin/calendar"),className:"w-full",children:e("admin.sessions.backToCalendar","Back to Calendar")})})]})}):(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(c.$,{variant:"ghost",size:"icon",onClick:()=>s.push("/admin/calendar"),children:(0,t.jsx)(m.A,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:e("admin.sessions.newTitle","New Session")}),(0,t.jsx)("p",{className:"text-muted-foreground",children:e("admin.sessions.newDescription","Create a new class session")})]})]}),(0,t.jsx)("form",{onSubmit:_(G),children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)(n.Zp,{className:"lg:col-span-2",children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{children:e("admin.sessions.basicInfo","Basic Information")}),(0,t.jsx)(n.BT,{children:e("admin.sessions.basicInfoDesc","Enter the basic details of the session")})]}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o.J,{htmlFor:"instructor",className:z.instructorId?"text-destructive":"",children:e("admin.sessions.instructor","Instructor")}),(0,t.jsx)(h.xI,{name:"instructorId",control:L,rules:{required:"Instructor is required"},render:s=>{let{field:a}=s;return(0,t.jsxs)(d.l6,{onValueChange:a.onChange,defaultValue:a.value,value:a.value,children:[(0,t.jsx)(d.bq,{id:"instructor",className:z.instructorId?"border-destructive":"",children:(0,t.jsx)(d.yv,{placeholder:e("admin.sessions.selectInstructor","Select an instructor")})}),(0,t.jsx)(d.gC,{children:T.map(e=>(0,t.jsx)(d.eb,{value:e.id.toString(),children:e.name},e.id))})]})}}),z.instructorId&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:z.instructorId.message})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o.J,{htmlFor:"course",className:z.courseId?"text-destructive":"",children:e("admin.sessions.course","Course")}),(0,t.jsx)(h.xI,{name:"courseId",control:L,rules:{required:"Course is required"},render:s=>{let{field:a}=s;return(0,t.jsxs)(d.l6,{onValueChange:a.onChange,defaultValue:a.value,value:a.value,children:[(0,t.jsx)(d.bq,{id:"course",className:z.courseId?"border-destructive":"",children:(0,t.jsx)(d.yv,{placeholder:e("admin.sessions.selectCourse","Select a course")})}),(0,t.jsx)(d.gC,{children:S.map(e=>(0,t.jsx)(d.eb,{value:e.id.toString(),children:e.title||e.name},e.id))})]})}}),z.courseId&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:z.courseId.message})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o.J,{htmlFor:"package",className:z.packageId?"text-destructive":"",children:e("admin.sessions.package","Package")}),(0,t.jsx)(h.xI,{name:"packageId",control:L,rules:{required:"Package is required"},render:s=>{let{field:a}=s;return(0,t.jsxs)(d.l6,{onValueChange:a.onChange,defaultValue:a.value,value:a.value,disabled:!$||0===F.length,children:[(0,t.jsx)(d.bq,{id:"package",className:z.packageId?"border-destructive":"",children:(0,t.jsx)(d.yv,{placeholder:$?0===F.length?e("admin.sessions.noPackages","No packages available"):e("admin.sessions.selectPackage","Select a package"):e("admin.sessions.selectCourseFirst","Select course first")})}),(0,t.jsx)(d.gC,{children:F.map(e=>(0,t.jsx)(d.eb,{value:e.id.toString(),children:e.name},e.id))})]})}}),z.packageId&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:z.packageId.message})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o.J,{htmlFor:"class",className:z.classId?"text-destructive":"",children:e("admin.sessions.class","Class")}),(0,t.jsx)(h.xI,{name:"classId",control:L,rules:{required:"Class is required"},render:s=>{let{field:a}=s;return(0,t.jsxs)(d.l6,{onValueChange:a.onChange,defaultValue:a.value,value:a.value,disabled:!U||0===R.length,children:[(0,t.jsx)(d.bq,{id:"class",className:z.classId?"border-destructive":"",children:(0,t.jsx)(d.yv,{placeholder:U?0===R.length?e("admin.sessions.noClasses","No classes available"):e("admin.sessions.selectClass","Select a class"):e("admin.sessions.selectPackageFirst","Select package first")})}),(0,t.jsx)(d.gC,{children:R.map(e=>(0,t.jsx)(d.eb,{value:e.id.toString(),children:e.title},e.id))})]})}}),z.classId&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:z.classId.message})]})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o.J,{htmlFor:"title",className:z.title?"text-destructive":"",children:e("admin.sessions.title","Title")}),(0,t.jsx)(l.p,{id:"title",className:z.title?"border-destructive":"",placeholder:e("admin.sessions.titlePlaceholder","Session Title"),...A("title",{required:"Title is required"})}),z.title&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:z.title.message})]})]})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{children:e("admin.sessions.scheduleInfo","Schedule Information")}),(0,t.jsx)(n.BT,{children:e("admin.sessions.scheduleInfoDesc","Set the date and time for the session")})]}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[(0,t.jsx)(h.xI,{name:"date",control:L,rules:{required:"Date is required"},render:s=>{var a;let{field:r}=s;return(0,t.jsx)(I,{label:e("admin.sessions.date","Date"),value:r.value,onChange:r.onChange,error:null===(a=z.date)||void 0===a?void 0:a.message})}}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(h.xI,{name:"startTime",control:L,rules:{required:"Start time is required"},render:s=>{var a;let{field:r}=s;return(0,t.jsx)(C,{label:e("admin.sessions.startTime","Start Time"),value:r.value,onChange:r.onChange,error:null===(a=z.startTime)||void 0===a?void 0:a.message})}}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o.J,{htmlFor:"duration",className:z.duration?"text-destructive":"",children:e("admin.sessions.duration","Duration (minutes)")}),(0,t.jsx)(l.p,{id:"duration",type:"number",min:"15",step:"15",className:z.duration?"border-destructive":"",...A("duration",{required:"Duration is required",min:{value:15,message:"Duration must be at least 15 minutes"}})}),z.duration&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:z.duration.message})]})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o.J,{children:e("admin.sessions.locationType","Location Type")}),(0,t.jsxs)("div",{className:"flex space-x-4",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"radio",id:"online",className:"mr-2",...A("isOnline"),value:"true",checked:!0===W,onChange:()=>V("isOnline",!0)}),(0,t.jsx)(o.J,{htmlFor:"online",className:"cursor-pointer",children:e("admin.sessions.online","Online")})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"radio",id:"offline",className:"mr-2",...A("isOnline"),value:"false",checked:!1===W,onChange:()=>V("isOnline",!1)}),(0,t.jsx)(o.J,{htmlFor:"offline",className:"cursor-pointer",children:e("admin.sessions.inPerson","In-Person")})]})]})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o.J,{htmlFor:"location",className:z.location?"text-destructive":"",children:W?e("admin.sessions.meetingLink","Meeting Link"):e("admin.sessions.location","Location")}),(0,t.jsx)(l.p,{id:"location",className:z.location?"border-destructive":"",placeholder:W?"https://zoom.us/j/123456789":"Room 101",...A("location",{required:"Location is required"})}),z.location&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:z.location.message})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o.J,{htmlFor:"capacity",className:z.capacity?"text-destructive":"",children:e("admin.sessions.capacity","Capacity")}),(0,t.jsx)(l.p,{id:"capacity",type:"number",min:"1",className:z.capacity?"border-destructive":"",...A("capacity",{required:"Capacity is required",min:{value:1,message:"Capacity must be at least 1"}})}),z.capacity&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:z.capacity.message})]})]}),(0,t.jsxs)(n.wL,{className:"flex justify-between",children:[(0,t.jsx)(c.$,{variant:"outline",onClick:()=>s.push("/admin/calendar"),type:"button",children:e("admin.sessions.cancel","Cancel")}),(0,t.jsx)(c.$,{type:"submit",className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700",disabled:Z,children:Z?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.A,{className:"mr-2 h-4 w-4 animate-spin"}),e("admin.sessions.creating","Creating...")]}):e("admin.sessions.createSession","Create Session")})]})]})]})})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[3438,5281,2105,2092,978,6039,5033,5616,1722,5022,5575,7358],()=>s(6339)),_N_E=e.O()}]);