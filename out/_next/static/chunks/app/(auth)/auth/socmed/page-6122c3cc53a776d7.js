(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7633],{4168:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(80364);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,s.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:i,className:c="",children:d,iconNode:u,...m}=e;return(0,s.createElement)("svg",{ref:t,...n,width:a,height:a,stroke:r,strokeWidth:i?24*Number(l)/Number(a):l,className:o("lucide",c),...m},[...u.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),i=(e,t)=>{let r=(0,s.forwardRef)((r,n)=>{let{className:i,...c}=r;return(0,s.createElement)(l,{ref:n,iconNode:t,className:o("lucide-".concat(a(e)),i),...c})});return r.displayName="".concat(e),r}},17411:(e,t,r)=>{"use strict";r.d(t,{ZR:()=>o,lm:()=>l,q$:()=>a,xw:()=>n});var s=r(15616);let a=async e=>{console.log("[AUTH] Requesting password reset for:",e);try{let t=await (0,s.Em)("auth/reset_password_request","POST",{email:e});return console.log("[AUTH] Password reset request successful"),t}catch(e){throw console.error("[AUTH] Password reset request failed:",e),e}},o=async(e,t)=>{console.log("[AUTH] Validating reset code for:",e);try{let r=await (0,s.Em)("auth/reset_password_validate","POST",{email:e,code:t});return console.log("[AUTH] Reset code validation successful"),r}catch(e){throw console.error("[AUTH] Reset code validation failed:",e),e}},n=async(e,t,r,a)=>{console.log("[AUTH] Resetting password for:",e);try{let o=await (0,s.Em)("auth/reset_password","POST",{email:e,code:t,password:r,password_confirmation:a});return console.log("[AUTH] Password reset successful"),o}catch(e){throw console.error("[AUTH] Password reset failed:",e),e}},l=async e=>{let t="http://worldmind.api/api";t.startsWith("http:")&&(t=t.replace("http:","https:")),t.endsWith("/")&&(t=t.slice(0,-1));let r="".concat(t,"/auth/byToken");console.log("[AUTH] Attempting token login");try{let t=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(e)},mode:"cors",credentials:"omit"});if(!t.ok){let e;let r=await t.text();try{e=JSON.parse(r)}catch(e){console.error("[AUTH] Error parsing response:",e)}throw Error((null==e?void 0:e.message)||"Server responded with status: ".concat(t.status))}let s=await t.json();if(!s.success)throw Error(s.message||"Token login failed. Please try again.");console.log("[AUTH] Token login successful:",s.data.name);let a={token:s.data.token,name:s.data.name,email:s.data.email,user_id:s.data.user_id,roles:s.data.roles,logged_in_status:s.data.logged_in_status,loggedin_at:s.data.loggedin_at};return localStorage.setItem("login_info",JSON.stringify(a)),{success:!0,data:a}}catch(e){if(console.error("[AUTH] Token login failed:",e),"TypeError"===e.name&&"Failed to fetch"===e.message)return{success:!1,message:"Network error: Could not connect to the server. Please check your connection and try again."};return{success:!1,message:e.message||"An error occurred during token login. Please try again."}}}},27236:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(2432),a=r(80364),o=r(39262),n=r(17411),l=r(77382),i=r(83881);function c(){let e=(0,o.useSearchParams)(),t=(0,o.useRouter)(),[r,c]=(0,a.useState)("loading"),[d,u]=(0,a.useState)("");return(0,a.useEffect)(()=>{(async()=>{let r=e.get("data");if(!r){c("error"),u("No authentication token provided");return}try{console.log("[SOCMED] Processing token login...");let e=await (0,n.lm)(r);if(e.success){c("success"),u("Login successful! Redirecting...");let r=e.data.roles||[],s=r.some(e=>"admin"===e.name||"administrator"===e.name),a=r.some(e=>"student"===e.name);setTimeout(()=>{s?t.push("/admin"):a?t.push("/student"):t.push("/main")},1500)}else c("error"),u(e.message||"Authentication failed")}catch(e){console.error("[SOCMED] Token login error:",e),c("error"),u("An error occurred during authentication")}})()},[e,t]),(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:(0,s.jsxs)(l.Zp,{className:"w-full max-w-md",children:[(0,s.jsx)(l.aR,{className:"text-center",children:(0,s.jsx)(l.ZB,{className:"text-2xl font-bold",children:"Social Media Authentication"})}),(0,s.jsxs)(l.Wu,{className:"text-center space-y-4",children:["loading"===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.A,{className:"h-8 w-8 animate-spin mx-auto"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Processing your authentication..."})]}),"success"===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"h-8 w-8 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:(0,s.jsx)("svg",{className:"h-5 w-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,s.jsx)("p",{className:"text-green-600 font-medium",children:d})]}),"error"===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"h-8 w-8 bg-red-100 rounded-full flex items-center justify-center mx-auto",children:(0,s.jsx)("svg",{className:"h-5 w-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsx)("p",{className:"text-red-600 font-medium",children:d}),(0,s.jsx)("button",{onClick:()=>t.push("/auth"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Back to Login"})]})]})]})})}},39262:(e,t,r)=>{"use strict";var s=r(66834);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},77382:(e,t,r)=>{"use strict";r.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>i,Zp:()=>n,aR:()=>l,wL:()=>u});var s=r(2432),a=r(80364),o=r(84963);let n=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});n.displayName="Card";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",r),...a})});l.displayName="CardHeader";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});i.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",r),...a})});d.displayName="CardContent";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",r),...a})});u.displayName="CardFooter"},83491:(e,t,r)=>{Promise.resolve().then(r.bind(r,27236))},83881:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(4168).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},84963:(e,t,r)=>{"use strict";r.d(t,{cn:()=>o});var s=r(12126),a=r(68441);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,s.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[3438,5616,5022,5575,7358],()=>t(83491)),_N_E=e.O()}]);