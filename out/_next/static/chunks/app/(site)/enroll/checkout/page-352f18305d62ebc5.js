(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6971],{9342:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>_});var r=a(2432),t=a(80364),n=a(39262),l=a(17338),o=a(21886),c=a(37800),i=a(56861),d=a(54889),m=a(72569),x=a(92105),u=a(77709),h=a(2708),p=a(77382),j=a(82196),f=a(22438),g=a(87304),y=a(41969),v=a(7886),N=a(3248),b=a(15616);function _(){let{t:e}=(0,x.Bd)(),s=(0,n.useSearchParams)(),a=(0,n.useRouter)();s.get("orderId")&&Number.parseInt(s.get("orderId"));let[_,w]=(0,t.useState)(null),[k,S]=(0,t.useState)([]),[C,P]=(0,t.useState)(null),[R,F]=(0,t.useState)(null),[M,A]=(0,t.useState)([]),[E,D]=(0,t.useState)("credit_card"),[B,I]=(0,t.useState)(""),[O,W]=(0,t.useState)(!1),[Z,L]=(0,t.useState)(0),[U,$]=(0,t.useState)({cardNumber:"",cardName:"",expiryDate:"",cvv:""}),[z,T]=(0,t.useState)({}),[Y,G]=(0,t.useState)(!0),[V,H]=(0,t.useState)(""),[J,K]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{let e=(0,N.dg)();if(console.log("Retrieved checkout data from storage:",e),e&&e.order&&e.order_items){console.log("Using checkout data from local storage:",e),w(e.order),S(e.order_items||[]);let s=e.order_items.find(e=>"course"===e.item_type),a=e.order_items.find(e=>"course_package"===e.item_type),r=e.order_items.filter(e=>"course_package_class"===e.item_type);if(console.log("Found course item:",s),console.log("Found package item:",a),console.log("Found class items:",r),s)try{console.log("Fetching course data for ID:",s.item_id);let e=await (0,c.YG)(s.item_id);console.log("Received course data:",e),P(e)}catch(e){console.error("Error fetching course data:",e)}if(a)try{console.log("Fetching package data for ID:",a.item_id);let e=await (0,i.$f)(a.item_id);console.log("Received package data:",e),e&&(e.price=a.total_price,F(e))}catch(e){console.error("Error fetching package data:",e)}if(r.length>0)try{console.log("Fetching class data for IDs:",r.map(e=>e.item_id));let e=r.map(e=>(0,d.Zc)(e.item_id)),s=await Promise.all(e);console.log("Received classes data:",s);let a=s.filter(Boolean).map(e=>{if(e){let s=r.filter(s=>s.item_id===e.id)[0];e.price=null!=s&&"number"==typeof s.total_price?e.price:0}return e});A(a)}catch(e){console.error("Error fetching class data:",e)}e.order&&(e.order.total_amount="number"==typeof e.order.total_amount?e.order.total_amount:0,e.order.discount_amount="number"==typeof e.order.discount_amount?e.order.discount_amount:0,e.order.final_amount="number"==typeof e.order.final_amount?e.order.final_amount:0),G(!1);return}console.error("No checkout data found in storage"),H("No checkout data found. Please select a course to enroll first."),G(!1)}catch(e){console.error("Error loading checkout data:",e),H("Failed to load order details"),G(!1)}})()},[]);let q=()=>{let e={};return T(e),0===Object.keys(e).length},Q=async e=>{if(e.preventDefault(),console.log("Form submitted"),!q()||!_){console.log("Form validation failed or no order data");return}K(!0),console.log("Processing payment...");try{let e=_.final_amount||0,s=Math.max(0,e-Z);console.log("Final amount after coupon:",s);let a="";"credit_card"===E?a="Online Payment via Stripe":"bank_transfer"===E&&(a="Bank Transfer");let r={order_id:0,method:E,description:a,amount_paid:s,reference:"PAY-".concat(Date.now()),status:"pending",paid_at:new Date().toISOString()};console.log("Created payment data:",r);let t=window.location.protocol,n=window.location.host,l="".concat(t,"//").concat(n);console.log("Current domain:",l);let o={...(0,N.dg)(),payment:r,payment_method:E,coupon_code:O?B:null,coupon_discount:Z,final_amount:s,redirect_success:"".concat(l,"/enroll/receipt"),redirect_failed:"".concat(l,"/enroll/failed")};console.log("Updating checkout data with payment info and redirect URLs:",o),(0,N.o3)(o),console.log("Sending checkout data to server...");let c=await (0,m.Uw)(o);if(console.log("Received checkout response:",c),c&&"OK"===c.status&&c.redirect)console.log("Redirecting to:",c.redirect),window.location.href=c.redirect;else throw console.error("Invalid response format:",c),Error("Invalid response from checkout service")}catch(e){console.error("Payment processing error:",e),K(!1),H("Payment processing failed. Please try again.")}};if(Y)return(0,r.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,r.jsx)(l.A,{}),(0,r.jsx)("main",{className:"flex-grow flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-secondary mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading checkout information..."})]})}),(0,r.jsx)(o.A,{})]});if(V)return(0,r.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,r.jsx)(l.A,{}),(0,r.jsx)("main",{className:"flex-grow flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-red-600 mb-2",children:"Error"}),(0,r.jsx)("p",{className:"text-gray-600",children:V}),(0,r.jsx)(h.$,{onClick:()=>a.back(),className:"mt-6",children:"Go Back"})]})}),(0,r.jsx)(o.A,{})]});if(!_)return(0,r.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,r.jsx)(l.A,{}),(0,r.jsx)("main",{className:"flex-grow flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-red-600 mb-2",children:"No Order Found"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Please select a course to enroll first."}),(0,r.jsx)(h.$,{onClick:()=>a.push("/courses"),className:"mt-6",children:"Browse Courses"})]})}),(0,r.jsx)(o.A,{})]});let X=_.tax_amount,ee=Math.max(0,(_.final_amount||0)-Z);return(0,r.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,r.jsx)(l.A,{}),(0,r.jsx)("main",{className:"flex-grow py-12 bg-gray-50",children:(0,r.jsxs)("div",{className:"container",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl md:text-4xl font-bold mb-4 font-heading",children:"Checkout"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Complete your payment to finalize your enrollment"})]}),(0,r.jsxs)("div",{className:"grid md:grid-cols-3 gap-8",children:[(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsxs)("form",{onSubmit:Q,className:"space-y-8",children:[(0,r.jsxs)(p.Zp,{className:"border-0 shadow-sm",children:[(0,r.jsx)(p.aR,{children:(0,r.jsx)(p.ZB,{children:"Payment Method"})}),(0,r.jsx)(p.Wu,{children:(0,r.jsxs)(j.z,{value:E,onValueChange:e=>{console.log("Payment method changed to:",e),D(e),T({})},className:"space-y-4",children:[(0,r.jsx)("div",{className:"border rounded-lg p-4 transition-colors hover:border-gray-300",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)(j.C,{value:"credit_card",id:"payment-credit-card",className:"mt-1"}),(0,r.jsxs)("div",{className:"ml-3 flex-grow",children:[(0,r.jsx)(f.J,{htmlFor:"payment-credit-card",className:"text-lg font-bold block mb-1",children:"Online Payment"}),(0,r.jsx)("p",{className:"text-gray-600 text-sm",children:"Pay securely using Stripe"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("div",{className:"w-10 h-6 bg-blue-600 rounded"}),(0,r.jsx)("div",{className:"w-10 h-6 bg-red-500 rounded"}),(0,r.jsx)("div",{className:"w-10 h-6 bg-yellow-500 rounded"})]})]})}),!1]})})]}),"credit_card"===E&&(0,r.jsx)(p.Zp,{className:"border-0 shadow-sm",children:(0,r.jsxs)(p.Wu,{className:"p-6",children:[(0,r.jsx)(v.Fc,{className:"bg-blue-50 border-blue-200 mb-4",children:(0,r.jsx)(v.TN,{className:"text-blue-800",children:'You will be redirected to our secure payment gateway to complete your payment after clicking "Confirm Payment".'})}),(0,r.jsx)("p",{className:"text-gray-600",children:"Our online payment system is secure and encrypted. Your payment information is never stored on our servers."})]})}),"bank_transfer"===E&&(0,r.jsx)(p.Zp,{className:"border-0 shadow-sm",children:(0,r.jsxs)(p.Wu,{className:"p-6",children:[(0,r.jsx)(v.Fc,{className:"bg-secondary-light border-secondary mb-4",children:(0,r.jsx)(v.TN,{className:"text-secondary",children:"Please make your payment to the following bank account within 48 hours."})}),(0,r.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"font-medium",children:"Bank Name:"}),(0,r.jsx)("span",{children:"World Mind Bank"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"font-medium",children:"Account Name:"}),(0,r.jsx)("span",{children:"World Mind Development Sdn Bhd"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"font-medium",children:"Account Number:"}),(0,r.jsx)("span",{children:"1234-5678-9012"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"font-medium",children:"Reference:"}),(0,r.jsxs)("span",{children:["WM-",Date.now().toString().slice(-6)]})]})]}),(0,r.jsx)("p",{className:"text-gray-600 text-sm",children:"Please include the reference number in your payment description. Your enrollment will be confirmed once payment is verified."})]})}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(h.$,{type:"submit",className:"bg-secondary text-primary hover:bg-secondary-dark",disabled:J,children:J?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary mr-2"}),"Processing..."]}):"Confirm Payment"})})]})}),(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"sticky top-6",children:(0,r.jsxs)(p.Zp,{className:"border-0 shadow-sm",children:[(0,r.jsx)(p.aR,{children:(0,r.jsx)(p.ZB,{children:"Order Summary"})}),(0,r.jsx)(p.Wu,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[Y?(0,r.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-secondary"})}):C?(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("div",{className:"relative w-20 h-20 rounded-md overflow-hidden shrink-0",children:(0,r.jsx)(u.default,{src:C.image||"/placeholder.svg",alt:C.title||"Course",fill:!0,className:"object-cover"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-bold",children:C.title||"Course"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:(null==R?void 0:R.name)||""})]})]}):(0,r.jsx)("div",{className:"text-gray-500 text-center py-2",children:"Course information not available"}),(0,r.jsx)(y.Separator,{}),(0,r.jsxs)("div",{className:"space-y-3",children:[R&&R.price>0&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:R.name||"Package"}),(0,r.jsxs)("span",{children:["RM ",(0,b.vv)(R.price)]})]}),M&&M.length>0?(0,r.jsx)(r.Fragment,{children:M.map(e=>(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:e.title||"Class"}),(0,r.jsxs)("span",{children:["RM ",(0,b.vv)(e.price)]})]},e.id))}):k.some(e=>"course_package_class"===e.item_type)&&(0,r.jsx)("div",{className:"text-gray-500 text-center py-1",children:"Loading class information..."})]}),(0,r.jsx)(y.Separator,{}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-bold mb-2",children:"Coupon Code"}),O?(0,r.jsxs)("div",{className:"flex justify-between items-center bg-green-50 border border-green-200 rounded-md p-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-green-700",children:B.toUpperCase()}),(0,r.jsx)("span",{className:"text-sm text-green-600 block",children:"10% discount applied"})]}),(0,r.jsx)(h.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>{if(console.log("Removing coupon code"),I(""),L(0),W(!1),z.coupon){let{coupon:e,...s}=z;T(s)}},className:"h-8 text-gray-500 hover:text-gray-700",children:"Remove"})]}):(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(g.p,{value:B,onChange:e=>I(e.target.value),placeholder:"Enter coupon code",className:z.coupon?"border-red-500":""}),(0,r.jsx)(h.$,{type:"button",variant:"outline",onClick:()=>{if(B.trim()&&_){if(console.log("Applying coupon code:",B),"WELCOME10"===B.toUpperCase()){let e=Math.round(.1*(_.final_amount||0));console.log("Coupon applied successfully. Discount amount:",e),L(e),W(!0),(0,N.o3)({coupon_code:B,coupon_discount:e})}else console.log("Invalid coupon code:",B),T({...z,coupon:"Invalid coupon code"})}},children:"Apply"})]}),z.coupon&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:z.coupon})]}),(0,r.jsx)(y.Separator,{}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Subtotal"}),(0,r.jsxs)("span",{children:["RM ",(0,b.vv)(_.total_amount)]})]}),_.discount_amount>0&&(0,r.jsxs)("div",{className:"flex justify-between text-green-600",children:[(0,r.jsx)("span",{children:"Package Discount"}),(0,r.jsxs)("span",{children:["- RM ",(0,b.vv)(_.discount_amount)]})]}),Z>0&&(0,r.jsxs)("div",{className:"flex justify-between text-green-600",children:[(0,r.jsx)("span",{children:"Coupon Discount"}),(0,r.jsxs)("span",{children:["- RM ",(0,b.vv)(Z)]})]}),X>0&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Tax"}),(0,r.jsxs)("span",{children:["RM ",(0,b.vv)(X)]})]}),(0,r.jsxs)("div",{className:"flex justify-between font-bold text-lg pt-2",children:[(0,r.jsx)("span",{children:"Total"}),(0,r.jsxs)("span",{children:["RM ",(0,b.vv)(ee)]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-center text-sm text-gray-500 mt-4",children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Secure Payment"]})]})})]})})})]})]})}),(0,r.jsx)(o.A,{})]})}},17581:(e,s,a)=>{Promise.resolve().then(a.bind(a,9342))}},e=>{var s=s=>e(e.s=s);e.O(0,[3438,1288,5281,7709,2105,8498,3981,2540,5616,7338,7035,5022,5575,7358],()=>s(17581)),_N_E=e.O()}]);